@page "/"
@using Microsoft.AspNetCore.Authorization
@using WebAppIntegrated.Enum
@* @attribute [Authorize(Roles = "admin,staff")] *@

<MudGrid Justify="Justify.SpaceAround" Spacing="3" Style="margin-top: 30px;">
    <!-- Hôm Nay -->
    <MudItem xs="12" sm="6" md="6">
        <MudPaper Class="pa-4" MaxWidth="700px" Elevation="0" Style="background-color: #f0f8ff;">
            <MudGrid>
                @if (_Statistical != null)
                {
                    var ordersInDay = _Statistical.Where(order => order.CreatedOn?.Day == DateTime.Now.Day
                    && order.CreatedOn?.Month == DateTime.Now.Month && order.CreatedOn?.Year == DateTime.Now.Year);
                    <MudItem xs="12">
                        <MudText Typo="Typo.h6" Align="Align.Center">Hôm Nay (@ordersInDay.Count())</MudText>
                        <MudText Typo="Typo.h4" Align="Align.Center">@string.Format("{0:#,##0}", ordersInDay.Where(order => order.OrderStatus == OrderStatus.Completed).Sum(order => order.TotalPrice))</MudText>
                    </MudItem>
                    <MudGrid>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn đang giải quyết:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInDay.Count(order => order.OrderStatus != OrderStatus.Completed && order.OrderStatus != OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn thành công:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInDay.Count(order => order.OrderStatus == OrderStatus.Completed)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn huỷ:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInDay.Count(order => order.OrderStatus == OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn trả:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">0</MudText>
                        </MudItem>
                    </MudGrid>
                }
            </MudGrid>
        </MudPaper>
    </MudItem>

    <!-- Tháng -->
    <MudItem xs="12" sm="6" md="6">
        <MudPaper Class="pa-4" MaxWidth="700px" Elevation="0" Style="background-color: #cce7ff;">
            <MudGrid>
                @if (_Statistical != null)
                {
                    var ordersInMonth = _Statistical.Where(order => order.CreatedOn?.Month == DateTime.Now.Month && order.CreatedOn?.Year == DateTime.Now.Year);
                    <MudItem xs="12">
                        <MudText Typo="Typo.h6" Align="Align.Center">Tháng Nay (@ordersInMonth.Count())</MudText>
                        <MudText Typo="Typo.h4" Align="Align.Center">@string.Format("{0:#,##0}", ordersInMonth.Where(order => order.OrderStatus == OrderStatus.Completed).Sum(order => order.TotalPrice))</MudText>
                    </MudItem>
                    <MudGrid>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn đang giải quyết:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInMonth.Count(order => order.OrderStatus != OrderStatus.Completed && order.OrderStatus != OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn thành công:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInMonth.Count(order => order.OrderStatus == OrderStatus.Completed)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn huỷ:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInMonth.Count(order => order.OrderStatus == OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn trả:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">0</MudText>
                        </MudItem>
                    </MudGrid>
                }
            </MudGrid>
        </MudPaper>
    </MudItem>

    <!-- Năm -->
    <MudItem xs="12" sm="6" md="6">
        <MudPaper Class="pa-4" MaxWidth="700px" Elevation="0" Style="background-color: #b3e0ff ;">
            <MudGrid>
                @if (_Statistical != null)
                {
                    var ordersInYear = _Statistical.Where(order => order.CreatedOn?.Year == DateTime.Now.Year);
                    <MudItem xs="12">
                        <MudText Typo="Typo.h6" Align="Align.Center">Năm Nay (@ordersInYear.Count())</MudText>
                        <MudText Typo="Typo.h4" Align="Align.Center">@string.Format("{0:#,##0}", ordersInYear.Where(order => order.OrderStatus == OrderStatus.Completed).Sum(order => order.TotalPrice))</MudText>
                    </MudItem>
                    <MudGrid>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn đang giải quyết:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInYear.Count(order => order.OrderStatus != OrderStatus.Completed && order.OrderStatus != OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn thành công:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInYear.Count(order => order.OrderStatus == OrderStatus.Completed)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn huỷ:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@ordersInYear.Count(order => order.OrderStatus == OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn trả:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">0</MudText>
                        </MudItem>
                    </MudGrid>
                }
            </MudGrid>
        </MudPaper>
    </MudItem>

    <!-- Tất Cả -->
    <MudItem xs="12" sm="6" md="6">
        <MudPaper Class="pa-4" MaxWidth="700px" Elevation="0" Style="background-color: #b0e0e6;">
            <MudGrid>
                @if (_Statistical != null)
                {
                    <MudItem xs="12">
                        <MudText Typo="Typo.h6" Align="Align.Center">Tất Cả (@_Statistical.Count())</MudText>
                        <MudText Typo="Typo.h4" Align="Align.Center">@string.Format("{0:#,##0}", _Statistical.Where(order => order.OrderStatus == OrderStatus.Completed).Sum(order => order.TotalPrice))</MudText>
                    </MudItem>
                    <MudGrid>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn đang giải quyết:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@_Statistical.Count(order => order.OrderStatus != OrderStatus.Completed && order.OrderStatus != OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="4">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn thành công:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@_Statistical.Count(order => order.OrderStatus == OrderStatus.Completed)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn huỷ:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">@_Statistical.Count(order => order.OrderStatus == OrderStatus.Cancelled)</MudText>
                        </MudItem>
                        <MudItem xs="2">
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Đơn trả:</MudText>
                            <MudText Typo="Typo.h6" Align="Align.Center">0</MudText>
                        </MudItem>
                    </MudGrid>
                }
            </MudGrid>
        </MudPaper>
    </MudItem>
</MudGrid>


<MudGrid Style="margin-top:15px" >
    <MudItem xs="12" sm="12" md="12">
        <MudText Typo="Typo.h5" Class="text-center" Style="margin-block: 10px; cursor: pointer;" @onclick="ToggleChart">
            <MudIcon Icon="@Icons.Material.Filled.BarChart" Style="margin-right: 8px;" />
            Sơ đồ doanh thu
        </MudText>
    </MudItem>

    @if (_showChart)
    {
        <MudItem xs="12">
            <MudChart ChartType="ChartType.Bar" ChartSeries="@Series"
                      XAxisLabels="@XAxisLabels" Width="1232px" Height="450px"></MudChart>
        </MudItem>
    }
</MudGrid>


<MudGrid Style="margin-top:30px">
    <MudItem xs="12" sm="7" md="7">

        @if (_lstOrderDetail != null)
        {
            <div class="border_box-shadow">            
                <MudText Typo="Typo.h6" Class="text-center" Style="margin-block: 35px;">
                    Top sản phẩm bán chạy
                </MudText>
             
                <MudTable Items="@_lstOrderDetail" Hover="true" Dense="true">
                    <HeaderContent>
                        <MudTh>STT</MudTh>
                        <MudTh>Tên</MudTh>
                        <MudTh>Image</MudTh>
                        <MudTh>Số Lượng</MudTh>
                       
                    </HeaderContent>

                    <RowTemplate>
                        <MudTd DataLabel="STT"> @(_lstOrderDetail.ToList().IndexOf(context) + 1)</MudTd>
                        <MudTd>@context.ProductName</MudTd>
                        <MudLink Href="" Style="text-decoration:none">
                            <MudImage Src="@($"{_imageUrl}{context.ImagePath}")" Width="60" Height="60" alt="Image" />
                        </MudLink>
                        <MudTd>@context.Quantity</MudTd>
                     
                    </RowTemplate>
                </MudTable>
            </div>
        }


    </MudItem>
@*     <MudItem xs="12" sm="5" md="5">

        @if (_lstProductDetail != null)
        {
            <div class="border_box-shadow">
                <MudText Typo="Typo.h6" Class="text-center" Style="margin-block: 35px;">
                    Sản phẩm sắp hết hàng
                </MudText>
                <MudSelect Dense="true" T="int" Label="Chọn số lượng" Variant="Variant.Outlined" Value="_paginationRequest.Stock" ValueChanged="@OnStockChanged">
                    <MudSelectItem Value="50">50</MudSelectItem>
                    <MudSelectItem Value="100">100</MudSelectItem>
                    <MudSelectItem Value="150">150</MudSelectItem>
                </MudSelect>
                <MudTable Items="@_lstProductDetail" Hover="true" Dense="true">
                    <HeaderContent>
                        <MudTh>STT</MudTh>
                        <MudTh>Tên</MudTh>
                        <MudTh>Image</MudTh>
                        <MudTh>Số Lượng</MudTh>

                    </HeaderContent>

                    <RowTemplate>
                        <MudTd DataLabel="STT"> @(_lstProductDetail.ToList().IndexOf(context) + 1)</MudTd>
                        <MudTd>@context.ProductName</MudTd>
                        <MudLink Href="" Style="text-decoration:none">
                            <MudImage Src="@($"{_imageUrl}{context.ImageUrl}")" Width="60" Height="60" alt="Image" />
                        </MudLink>
                        <MudTd>@context.Stock</MudTd>

                    </RowTemplate>
                </MudTable>
            </div>
        }
    </MudItem> *@

</MudGrid>

